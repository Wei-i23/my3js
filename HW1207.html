<html>
<head>
<style>
#info {
  position: absolute;
  text-align: center;
  width: 100vw;
}
</style>
<body>
<div id="info">
	<h1 style='color:pink'>Billboard Forest</h1>
	<button id='start'>start</button>

</div>

<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>


<script>
javascript:(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='https://mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()

$('#start').click (function() {
	clockOn = true;
	setTimeout(countDown,0);
	counter = 5;
	
	scene.add(number);
});


var camera,scene,renderer;
var clockOn;	//whether the clock is running
var counter,number,oldColor,plane;
var lit = true;
var start = false;

init();
animate();


function countDown(){
	if(clockOn === false){
		scene.remove(number);	//到0時移除數字並準備顯示blinker
		counter=10;
		setTimeout(blinker,0);
		return;
	}
	else
		setTimeout(countDown,1000);
	
	if(number){
		var texture = number.material.map;
		texture.offset.x -= 0.2;	//控制數字的移動
	}
	counter--;
	
	if(counter === 0){
		clockOn = false;
	}
}

function buildSprite(){
	var geometry = new THREE.Geometry();
	geometry.vertices.push(		//調整動畫大小
		new THREE.Vector3(-10, -10, 0),
		new THREE.Vector3(10, -10, 0),
		new THREE.Vector3(10, 10, 0),
		new THREE.Vector3(-10, 10, 0)
	);

	var face;
	face = new THREE.Face3(0, 1, 2);
	geometry.faces.push(face);
	face = new THREE.Face3(0, 2, 3);
	geometry.faces.push(face);
  
	var uv0 = new THREE.Vector2(0.0,0.0);
	var uv1 = new THREE.Vector2(0.2,0.0);
	var uv2 = new THREE.Vector2(0.2,1.0);
	var uv3 = new THREE.Vector2(0.0,1.0);
  
	geometry.faceVertexUvs[0].push([uv0, uv1, uv2]);
	geometry.faceVertexUvs[0].push([uv0, uv2, uv3]);

	geometry.computeBoundingSphere();
	geometry.computeFaceNormals();
	geometry.computeVertexNormals();
	return geometry;
	
}

//調整窗口大小
function onWindowResize() {
	camera.aspect = window.innerWidth / window.innerHeight;
	camera.updateProjectionMatrix();
	renderer.setSize(window.innerWidth, window.innerHeight);
}

function init(){
	scene = new THREE.Scene();

	camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);	//用來用3D
	camera.position.z = 100;
	scene.add(camera);
	window.addEventListener('resize', onWindowResize, false);

	renderer = new THREE.WebGLRenderer({antialias:true});	//antialias可以增加抗鉅齒
	renderer.setSize(window.innerWidth, window.innerHeight);
	renderer.setClearColor(0x888888);
	document.body.appendChild(renderer.domElement);
	
	let controls = new THREE.OrbitControls(camera, renderer.domElement);
	

	//12345
	var loader = new THREE.TextureLoader();
	loader.crossOrigin = '';
	loader.load('https://i.imgur.com/f2MShYR.png',
		function(texture){
			var texMat = new THREE.MeshBasicMaterial({
				map: texture,
				transparent: true,
				side: THREE.DoubleSide
			});
			number = new THREE.Mesh(buildSprite(),texMat); 
			texture.wrapS = THREE.RepeatWrapping;
			texture.wrapT = THREE.RepeatWrapping;
			
			
		},
	);
	
	//時間到
	plane = new THREE.Mesh(new THREE.PlaneGeometry(20,20),new THREE.MeshBasicMaterial({color:0xff0000}));
	//scene.add(plane);
	
	oldColor = new THREE.Color();
	plane.material.color.getHSL(oldColor);
	
}
//blink
function blinker(){
	if(lit === true)
		plane.material.color.setHSL(oldColor.h,oldColor.s,1.0);
	else
		plane.material.color.setHSL(oldColor.h,oldColor.s,oldColor.l);
	
	lit = !lit;
		
	if(clockOn === false){
		scene.add(plane);
		setTimeout(blinker,2000);
		counter--;
	}
	else
		scene.remove(plane);
}

function animate() {

	
	requestAnimationFrame(animate);
	renderer.render(scene, camera);
}


</script>
</body>
</html>
